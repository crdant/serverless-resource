#!/bin/sh
set -e

exec 3>&1 # make stdout available as fd 3 for the result
exec 1>&2 # redirect all output to stderr for logging

destination=$1

if [ -z "$destination" ]; then
  echo "usage: $0 <path/to/destination>" >&2
  exit 1
fi

. $(dirname $0)/common.sh

export PATH=/usr/local/bin:${PATH}

store_payload
echo "remove me later, only for development"
echo "payload: ${payload}"
version=$(extract_parameter "version")
package=$(extract_parameter "package")
deploy=$(extract_parameter "deploy")

serverless_cmd info

jq -n "{
  version: {
    "ref": "${version}"
  },
  metadata: [
    "package": "${package}"
  ]
}" >&3
